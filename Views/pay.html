<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh Toán - Sushi House</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Segoe UI',sans-serif; background:#fdfafa; color:#333; padding-top:100px; }

        header {
            background:#c41e3a; color:white; position:fixed; top:0; width:100%; z-index:1000;
            padding:15px 5%; display:flex; justify-content:space-between; align-items:center;
            box-shadow:0 2px 15px rgba(0,0,0,0.1);
        }
        .logo { font-size:28px; font-weight:bold; color:white; text-decoration:none; }
        .logo span { color:#ffeb3b; }
        .back-btn { color:white; text-decoration:none; font-size:16px; }
        .back-btn i { margin-right:8px; }

        .container {
            max-width:1200px; margin:40px auto; padding:0 20px;
            display:grid; grid-template-columns:1fr 420px; gap:40px;
        }

        .form-section, .order-summary {
            background:white; border-radius:16px; padding:30px;
            box-shadow:0 8px 30px rgba(0,0,0,0.08);
        }

        h2 { font-size:26px; color:#c41e3a; margin-bottom:25px; text-align:center; }

        .form-group { margin-bottom:20px; }
        label { display:block; margin-bottom:8px; font-weight:600; }
        input, select, textarea {
            width:100%; padding:14px; border:2px solid #eee; border-radius:12px;
            font-size:16px; transition:0.3s;
        }
        input:focus, select:focus, textarea:focus {
            outline:none; border-color:#c41e3a;
        }

        .row { display:grid; grid-template-columns:1fr 1fr; gap:15px; }

        .payment-methods {
            display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:15px; margin:20px 0;
        }
        .payment-method {
            border:2px solid #eee; border-radius:12px; padding:15px; text-align:center;
            cursor:pointer; transition:0.3s;
        }
        .payment-method.active, .payment-method:hover {
            border-color:#c41e3a; background:#c41e3a;
        }
        .payment-method i { font-size:28px; margin-bottom:8px; }

        .order-item {
            display:flex; align-items:center; padding:15px 0; border-bottom:1px solid #eee;
        }
        .order-item img { width:70px; height:70px; object-fit:cover; border-radius:10px; margin-right:15px; }
        .item-info { flex:1; }
        .item-name { font-weight:600; }
        .item-price { color:#c41e3a; font-weight:bold; }

        .summary-line {
            display:flex; justify-content:space-between; padding:12px 0; font-size:16px;
        }
        .summary-line.total {
            font-size:20px; font-weight:bold; color:#c41e3a; padding-top:20px; border-top:2px solid #eee;
        }

        .btn-checkout {
            width:100%; padding:18px; background:#c41e3a; color:white; border:none;
            border-radius:50px; font-size:20px; font-weight:bold; cursor:pointer; margin-top:25px;
            transition:0.3s;
        }
        .btn-checkout:hover { background:#a1172d; }

        .coupon-box {
            display:flex; gap:10px; margin:15px 0;
        }
        .coupon-box input { flex:1; }
        .coupon-box button {
            padding:0 25px; background:#ffeb3b; color:#c41e3a; border:none; border-radius:12px;
            font-weight:bold; cursor:pointer;
        }

        @media (max-width:968px) {
            .container { grid-template-columns:1fr; }
            .order-summary { order:-1; }
        }
    </style>
</head>
<body>

    <header>
        <a href="Home.html" class="back-btn">Quay lại</a>
        <a href="Home.html" class="logo">Sushi<span>House</span></a>
        <div></div>
    </header>

    <div class="container">
        <!-- Form thông tin giao hàng -->
        <div class="form-section">
            <h2>Thông Tin Giao Hàng</h2>
            <form id="checkoutForm">
                <div class="form-group">
                    <label>Họ và tên *</label>
                    <input type="text" required placeholder="Nguyễn Văn A">
                </div>

                <div class="row">
                    <div class="form-group">
                        <label>Số điện thoại *</label>
                        <input type="tel" required placeholder="0901234567">
                    </div>
                    <div class="form-group">
                        <label>Email (không bắt buộc)</label>
                        <input type="email" placeholder="email@gmail.com">
                    </div>
                </div>

                <div class="form-group">
                    <label>Địa chỉ giao hàng *</label>
                    <input type="text" required placeholder="Số nhà, đường, phường/xã...">
                </div>

                <div class="row">
                    <div class="form-group">
                        <label>Quận/Huyện *</label>
                        <select required>
                            <option value="">-- Chọn quận/huyện --</option>
                            <option>Quận 1</option><option>Quận 3</option><option>Quận 5</option>
                            <option>Quận 7</option><option>Quận Bình Thạnh</option><option>TP. Thủ Đức</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Thành phố *</label>
                        <select required><option>TP. Hồ Chí Minh</option></select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Ghi chú (không bắt buộc)</label>
                    <textarea rows="3" placeholder="Giao giờ hành chính, gọi trước 10 phút..."></textarea>
                </div>

                <h2 style="margin:40px 0 20px;">Phương Thức Thanh Toán</h2>
                <div class="payment-methods">
                    <div class="payment-method active" data-method="cod">
                        <i class="fas fa-money-bill-wave"></i>
                        <div>Thanh toán khi nhận hàng (COD)</div>
                    </div>
                    <div class="payment-method" data-method="momo">
                        <i class="fas fa-mobile-alt"></i>
                        <div>Momo</div>
                    </div>
                    <div class="payment-method" data-method="bank">
                        <i class="fas fa-university"></i>
                        <div>Chuyển khoản ngân hàng</div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Tóm tắt đơn hàng -->
        <div class="order-summary">
            <h2>Đơn Hàng Của Bạn</h2>

            <div id="orderItems">
                <!-- Render động bằng JS -->
            </div>

            <div class="coupon-box">
                <input type="text" id="coupon" placeholder="Nhập mã giảm giá">
                <button type="button" onclick="applyCoupon()">Áp dụng</button>
            </div>
            <div id="couponMsg" style="color:#c41e3a; font-size:14px; margin-bottom:10px;"></div>

            <div class="summary-line">
                <span>Tạm tính (<span id="itemCount">0</span> món)</span>
                <span id="subtotal">0đ</span>
            </div>
            <div class="summary-line">
                <span>Phí vận chuyển</span>
                <span id="shipping">30.000đ</span>
            </div>
            <div class="summary-line" id="discountLine" style="display:none;">
                <span>Giảm giá</span>
                <span id="discount">-0đ</span>
            </div>
            <div class="summary-line total">
                <span>Tổng cộng</span>
                <span id="total">0đ</span>
            </div>

            <button class="btn-checkout" onclick="placeOrder()">
                HOÀN TẤT ĐẶT HÀNG
            </button>
        </div>
    </div>

    <script>
        let discountAmount = 0;

        // Load giỏ hàng và render
        function loadOrder() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const container = document.getElementById('orderItems');
            let subtotal = 0;
            let totalQty = 0;

            if (cart.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#999;">Giỏ hàng trống</p>';
                document.querySelector('.btn-checkout').disabled = true;
                updateSummary(0, 0);
                return;
            }

            container.innerHTML = '';
            cart.forEach(item => {
                subtotal += item.price * item.qty;
                totalQty += item.qty;

                const div = document.createElement('div');
                div.className = 'order-item';
                div.innerHTML = `
                    <img src="${item.img}" alt="${item.name}">
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div style="color:#666; font-size:14px;">${item.qty} x ${item.price.toLocaleString('vi-VN')}đ</div>
                    </div>
                    <div class="item-price">${(item.price * item.qty).toLocaleString('vi-VN')}đ</div>
                `;
                container.appendChild(div);
            });

            updateSummary(subtotal, totalQty);
        }

        function updateSummary(subtotal, qty) {
            document.getElementById('subtotal').textContent = subtotal.toLocaleString('vi-VN') + 'đ';
            document.getElementById('itemCount').textContent = qty;
            const total = subtotal + 30000 - discountAmount;
            document.getElementById('total').textContent = total.toLocaleString('vi-VN') + 'đ';
        }

        function applyCoupon() {
            const code = document.getElementById('coupon').value.trim().toUpperCase();
            const msg = document.getElementById('couponMsg');

            // Ví dụ mã giảm giá
            if (code === 'SUSHI20') {
                discountAmount = 20000;
                msg.textContent = 'Áp dụng mã SUSHI20 thành công – Giảm 20.000đ!';
                document.getElementById('discountLine').style.display = 'flex';
                document.getElementById('discount').textContent = '-20.000đ';
            } else if (code === 'FREESHIP') {
                discountAmount = 30000;
                msg.textContent = 'Áp dụng mã FREESHIP thành công – Miễn phí vận chuyển!';
                document.getElementById('discountLine').style.display = 'flex';
                document.getElementById('discount').textContent = '-30.000đ';
                document.getElementById('shipping').textContent = '0đ';
            } else if (code !== '') {
                msg.textContent = 'Mã giảm giá không hợp lệ!';
                discountAmount = 0;
                document.getElementById('discountLine').style.display = 'none';
            } else {
                discountAmount = 0;
                document.getElementById('discountLine').style.display = 'none';
            }
            loadOrder(); // cập nhật lại tổng
        }

        function placeOrder() {
            if (document.querySelectorAll('.order-item').length === 0) {
                alert('Giỏ hàng trống!');
                return;
            }
            if (!document.getElementById('checkoutForm').checkValidity()) {
                alert('Vui lòng điền đầy đủ thông tin giao hàng!');
                return;
            }

            alert('Đặt hàng thành công! Cảm ơn bạn đã mua sắm tại Sushi House Chúng tôi sẽ liên hệ ngay!');

            // Xóa giỏ hàng
            localStorage.removeItem('cart');
            // Chuyển về trang chủ sau 1s
            setTimeout(() => {
                window.location.href = 'Home.html';
            }, 1000);
        }

        // Chạy khi load trang
        window.onload = loadOrder;

        // Highlight phương thức thanh toán
        document.querySelectorAll('.payment-method').forEach(method => {
            method.addEventListener('click', function() {
                document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('active'));
                this.classList.add('active');
            });
        });
        if (!localStorage.getItem('currentUser')) {
    alert('Vui lòng đăng nhập để thanh toán!');
    window.location.href = 'login.html';
}
    </script>
</body>
</html>